<?xml version="1.0"?>
<project name="Web Look and Feel" basedir="../" default="build.basic.artifacts">

    <!-- =========================== Includes ============================ -->

    <!-- Property files -->
    <property file="build/version.properties" />
    <property file="build/build.properties" />

    <!-- =========================== Classpath settings ============================ -->

    <!-- Compile classpaths -->
    <path id="core.classpath">
        <fileset dir="${lib.dir}" includes="*.jar" />
    </path>
    <path id="plugin.classpath">
        <fileset dir="${lib.dir}" includes="*.jar" />
        <pathelement path="${module.core.dist.dir}" />
    </path>
    <path id="ui.classpath">
        <fileset dir="${lib.dir}" includes="*.jar" />
        <pathelement path="${module.core.dist.dir}" />
    </path>
    <path id="demo.classpath">
        <fileset dir="${lib.dir}" includes="*.jar" />
        <pathelement path="${module.core.dist.dir}" />
        <pathelement path="${module.ui.dist.dir}" />
    </path>

    <!-- JAR classpaths -->
    <property name="core.jar.classpath" value="${module.core.lib}" />
    <property name="plugin.jar.classpath" value="${module.core.lib} ${module.core.jar.name}" />
    <property name="ui.jar.classpath" value="${module.ui.lib} ${module.core.jar.name}" />
    <property name="demo.jar.classpath" value="${module.ui.lib} ${module.core.jar.name} ${module.ui.jar.name}" />
    <property name="full.classpath" value="${module.ui.lib}" />

    <!-- =========================== Base targets ============================ -->

    <!-- Dist directory -->
    <target name="clean.dist.dir">
        <delete dir="${dist.dir}" />
    </target>
    <target name="create.dist.dir">
        <mkdir dir="${dist.dir}" />
    </target>

    <!-- Artifacts directory -->
    <target name="clean.artifacts.dir">
        <delete dir="${artifacts.dir}" />
    </target>
    <target name="create.artifacts.dir">
        <mkdir dir="${artifacts.dir}" />
    </target>

    <!-- Compile classes -->
    <target name="compile.core" depends="create.dist.dir">
        <mkdir dir="${module.core.dist.dir}" />
        <javac debug="true" includeantruntime="false" destdir="${module.core.dist.dir}" encoding="utf-8" source="1.6" target="1.6">
            <src path="${module.core.src.dir}" />
            <classpath refid="core.classpath" />
        </javac>
    </target>
    <target name="compile.plugin" depends="compile.core">
        <mkdir dir="${module.plugin.dist.dir}" />
        <javac debug="true" includeantruntime="false" destdir="${module.plugin.dist.dir}" encoding="utf-8" source="1.6" target="1.6">
            <src path="${module.plugin.src.dir}" />
            <classpath refid="plugin.classpath" />
        </javac>
    </target>
    <target name="compile.ui" depends="compile.core">
        <mkdir dir="${module.ui.dist.dir}" />
        <javac debug="true" includeantruntime="false" destdir="${module.ui.dist.dir}" encoding="utf-8" source="1.6" target="1.6">
            <src path="${module.ui.src.dir}" />
            <classpath refid="ui.classpath" />
        </javac>
    </target>
    <target name="compile.demo" depends="compile.ui">
        <mkdir dir="${module.demo.dist.dir}" />
        <javac debug="true" includeantruntime="false" destdir="${module.demo.dist.dir}" encoding="utf-8" source="1.6" target="1.6">
            <src path="${module.demo.src.dir}" />
            <classpath refid="demo.classpath" />
        </javac>
    </target>

    <!-- Resources copy -->
    <target name="copy.core.res">
        <copy todir="${module.core.dist.dir}">
            <fileset dir="${module.core.src.dir}" excludes="**/*.java" />
        </copy>
    </target>
    <target name="copy.plugin.res" depends="copy.core.res">
        <copy todir="${module.plugin.dist.dir}">
            <fileset dir="${module.plugin.src.dir}" excludes="**/*.java" />
        </copy>
    </target>
    <target name="copy.ui.res" depends="copy.core.res">
        <copy todir="${module.ui.dist.dir}">
            <fileset dir="${module.ui.src.dir}" excludes="**/*.java" />
        </copy>
    </target>
    <target name="copy.demo.res" depends="copy.ui.res">
        <copy todir="${module.demo.dist.dir}">
            <fileset dir="${module.demo.src.dir}" excludes="**/*.java" />
        </copy>
    </target>
    <target name="copy.core.src">
        <copy todir="${module.core.dist.dir}">
            <fileset dir="${module.core.src.dir}" />
        </copy>
    </target>
    <target name="copy.ui.src">
        <copy todir="${module.ui.dist.dir}">
            <fileset dir="${module.ui.src.dir}" />
        </copy>
    </target>
    <target name="copy.demo.src">
        <copy todir="${module.demo.dist.dir}">
            <fileset dir="${module.demo.src.dir}" />
        </copy>
    </target>
    <target name="copy.lic">
        <copy todir="${dist.dir}/licenses">
            <fileset dir="${lic.dir}" />
        </copy>
    </target>
    <target name="copy.lib">
        <copy todir="${artifacts.dir}">
            <fileset dir="${lib.dir}" />
        </copy>
    </target>
    <target name="copy.demo.jnlp">
        <copy todir="${artifacts.dir}">
            <fileset file="${demo.application.jnlp}" />
        </copy>
    </target>

    <!-- =========================== Separate binaries ============================ -->

    <!-- Assemble library core jar -->
    <target name="build.module.core.jar" description="Build ${module.core.jar}" depends="clean.dist.dir,compile.core,copy.core.res,copy.lic,create.artifacts.dir">
        <jar destfile="${module.core.jar}">
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.core.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${module.core.title}" />
                <attribute name="Class-Path" value="${core.jar.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble library plugin jar -->
    <target name="build.module.plugin.jar" description="Build ${module.plugin.jar}" depends="clean.dist.dir,compile.plugin,copy.plugin.res,copy.lic,create.artifacts.dir">
        <jar destfile="${module.plugin.jar}">
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.plugin.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${module.plugin.title}" />
                <attribute name="Class-Path" value="${plugin.jar.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble library ui jar -->
    <target name="build.module.ui.jar" description="Build ${module.ui.jar}" depends="clean.dist.dir,compile.ui,copy.ui.res,copy.lic,create.artifacts.dir">
        <jar destfile="${module.ui.jar}">
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.ui.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${module.ui.title}" />
                <attribute name="Main-Class" value="${module.ui.main}" />
                <attribute name="Class-Path" value="${ui.jar.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble library demo jar -->
    <target name="build.module.demo.jar" description="Build ${module.demo.jar}" depends="compile.demo,copy.demo.res,copy.lic,create.artifacts.dir">
        <jar destfile="${module.demo.jar}">
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.demo.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${module.demo.title}" />
                <attribute name="Main-Class" value="${module.demo.main}" />
                <attribute name="Class-Path" value="${demo.jar.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- =========================== Complete binaries ============================ -->

    <!-- Assemble library binary -->
    <target name="build.complete.jar" description="Build ${library.complete.jar}" depends="clean.dist.dir,compile.plugin,compile.ui,copy.ui.res,copy.lic,create.artifacts.dir">
        <jar destfile="${library.complete.jar}">
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.core.dist.dir}" />
            <fileset dir="${module.plugin.dist.dir}" />
            <fileset dir="${module.ui.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${library.complete.title}" />
                <attribute name="Main-Class" value="${library.complete.main}" />
                <attribute name="Class-Path" value="${full.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble complete library binary -->
    <target name="build.complete.deps.jar" description="Build ${library.complete.deps.jar}" depends="clean.dist.dir,compile.plugin,compile.ui,copy.ui.res,copy.lic,create.artifacts.dir">
        <jar destfile="${library.complete.deps.jar}">
            <zipfileset src="${lib.dir}/${slf4j.api.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${slf4j.binding.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${imagescaling.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${jericho.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${xstream.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${svgsalamander.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${rsyntaxtextarea.jar}" excludes="META-INF/**" />
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.core.dist.dir}" />
            <fileset dir="${module.plugin.dist.dir}" />
            <fileset dir="${module.ui.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${library.complete.deps.title}" />
                <attribute name="Main-Class" value="${library.complete.deps.main}" />
            </manifest>
        </jar>
    </target>

    <!-- =========================== Featured binaries ============================ -->

    <!-- Assemble library demo -->
    <target name="build.weblaf.demo.jar" description="Build ${demo.application.jar}" depends="clean.dist.dir,compile.plugin,compile.demo,copy.demo.res,copy.lic,create.artifacts.dir,copy.demo.jnlp">
        <jar destfile="${demo.application.jar}">
            <zipfileset src="${lib.dir}/${slf4j.api.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${slf4j.binding.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${imagescaling.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${jericho.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${xstream.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${svgsalamander.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${rsyntaxtextarea.jar}" excludes="META-INF/**" />
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.core.dist.dir}" />
            <fileset dir="${module.core.src.dir}" includes="**/*.java" />
            <fileset dir="${module.plugin.dist.dir}" />
            <fileset dir="${module.plugin.src.dir}" includes="**/*.java" />
            <fileset dir="${module.ui.dist.dir}" />
            <fileset dir="${module.ui.src.dir}" includes="**/*.java" />
            <fileset dir="${module.demo.dist.dir}" />
            <fileset dir="${module.demo.src.dir}" includes="**/*.java" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${demo.application.title}" />
                <attribute name="Main-Class" value="${demo.application.main}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble nine-patch editor jar -->
    <target name="build.npe.jar" description="Build ${ninepatcheditor.jar}" depends="clean.dist.dir,compile.plugin,compile.ui,copy.ui.res,copy.lic,create.artifacts.dir">
        <jar destfile="${ninepatcheditor.jar}">
            <zipfileset src="${lib.dir}/${slf4j.api.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${slf4j.binding.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${imagescaling.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${jericho.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${xstream.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${svgsalamander.jar}" excludes="META-INF/**" />
            <zipfileset src="${lib.dir}/${rsyntaxtextarea.jar}" excludes="META-INF/**" />
            <fileset dir="${dist.dir}" includes="licenses/**" />
            <fileset dir="${module.core.dist.dir}" />
            <fileset dir="${module.plugin.dist.dir}" />
            <fileset dir="${module.ui.dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${ninepatcheditor.title}" />
                <attribute name="Main-Class" value="${ninepatcheditor.main}" />
            </manifest>
        </jar>
    </target>

    <!-- =========================== Misc binaries ============================ -->

    <!-- Assemble library sources ZIP archive -->
    <target name="build.sources.zip" description="Build ${sources.zip}" depends="clean.dist.dir,create.dist.dir,create.artifacts.dir">
        <copy todir="${dist.dir}/build">
            <fileset dir="${build.dir}" />
        </copy>
        <copy todir="${dist.dir}/lib">
            <fileset dir="${lib.dir}" />
        </copy>
        <copy todir="${dist.dir}/licenses">
            <fileset dir="${lic.dir}" />
        </copy>
        <copy todir="${dist.dir}/modules">
            <fileset dir="${modules.dir}" excludes="**/*.iml">
                <exclude name="test/**" />
            </fileset>
        </copy>
        <zip destfile="${sources.zip}">
            <fileset dir="${dist.dir}" />
        </zip>
    </target>

    <!-- Assemble library sources JAR -->
    <target name="build.sources.jar" description="Build ${sources.jar}" depends="clean.dist.dir,create.dist.dir,create.artifacts.dir">
        <copy todir="${dist.dir}/licenses">
            <fileset dir="${lic.dir}" />
        </copy>
        <copy todir="${dist.dir}">
            <fileset dir="${module.core.src.dir}" />
            <fileset dir="${module.plugin.src.dir}" />
            <fileset dir="${module.ui.src.dir}" />
            <fileset dir="${module.demo.src.dir}" />
        </copy>
        <jar destfile="${sources.jar}">
            <fileset dir="${dist.dir}" />
            <manifest>
                <attribute name="Package-Title" value="${package}" />
                <attribute name="Package-Vendor" value="${dev}" />
                <attribute name="Package-Version" value="${version.info}" />
                <attribute name="Product-Name" value="${library.complete.title}" />
                <attribute name="Main-Class" value="${library.complete.main}" />
                <attribute name="Class-Path" value="${full.classpath}" />
            </manifest>
        </jar>
    </target>

    <!-- Assemble JavaDoc JAR -->
    <target name="build.javadoc.jar" description="Build ${javadoc.jar}" depends="create.artifacts.dir">
        <javadoc destdir="${javadoc.dir}" author="true" version="true" use="true">
            <packageset dir="${module.core.src.dir}" defaultexcludes="yes" />
            <packageset dir="${module.plugin.src.dir}" defaultexcludes="yes" />
            <packageset dir="${module.ui.src.dir}" defaultexcludes="yes" />
            <packageset dir="${module.demo.src.dir}" defaultexcludes="yes" />
            <classpath refid="demo.classpath" />
        </javadoc>
        <zip destfile="${javadoc.jar}">
            <fileset dir="${javadoc.dir}" />
        </zip>
    </target>

    <!-- =========================== Versioning targets ============================ -->

    <!-- Assemble and run version updater jar -->
    <target name="update.library.version" depends="clean.dist.dir,compile.ui,copy.ui.res,create.artifacts.dir">
        <jar destfile="${vupdater.jar}">
            <fileset dir="${module.ui.dist.dir}" />
            <manifest>
                <attribute name="Main-Class" value="${vupdater.main}" />
                <attribute name="Class-Path" value="${ui.jar.classpath}" />
            </manifest>
        </jar>
        <java jar="${vupdater.jar}" fork="true" />
        <delete file="${vupdater.jar}" />
    </target>

    <!-- Copy XML version file into artifacts folder -->
    <target name="copy.version.file">
        <copy file="${xml.version.file}" todir="${artifacts.dir}" />
    </target>

    <!-- =========================== Complex targets ============================ -->

    <!-- Assemble all artifacts -->
    <target name="build.all.artifacts" description="Build all WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="build.base.impl" />
        <antcall target="build.complete.impl" />
        <antcall target="build.featured.impl" />
        <antcall target="build.src.impl" />
        <antcall target="build.javadoc.impl" />
        <antcall target="clean.dist.dir" />
    </target>

    <!-- Assemble basic artifacts -->
    <target name="build.basic.artifacts" description="Build basic WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="build.base.impl" />
        <antcall target="build.src.impl" />
        <antcall target="clean.dist.dir" />
    </target>

    <!-- Assemble common artifacts -->
    <target name="build.common.artifacts" description="Build common WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="build.base.impl" />
        <antcall target="build.complete.impl" />
        <antcall target="build.featured.impl" />
        <antcall target="build.src.impl" />
        <antcall target="clean.dist.dir" />
    </target>

    <!-- Assemble release artifacts -->
    <target name="build.release.artifacts" description="Build release WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.base.impl" />
        <antcall target="build.complete.impl" />
        <antcall target="build.featured.impl" />
        <antcall target="build.src.impl" />
        <antcall target="build.javadoc.impl" />
        <antcall target="copy.version.file" />
        <antcall target="update.library.version" />
        <antcall target="clean.dist.dir" />
    </target>

    <!-- Single assembled builds -->
    <target name="build.base.artifacts" description="Build base WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.base.impl" />
        <antcall target="clean.dist.dir" />
    </target>
    <target name="build.complete.artifacts" description="Build unified WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.complete.impl" />
        <antcall target="clean.dist.dir" />
    </target>
    <target name="build.featured.artifacts" description="Build featured WebLaF binaries">
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.featured.impl" />
        <antcall target="clean.dist.dir" />
    </target>
    <target name="build.misc.artifacts" description="Build miscellaneous WebLaF binaries" >
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.src.impl" />
        <antcall target="clean.dist.dir" />
    </target>
    <target name="build.javadoc.artifacts" description="Build WebLaF JavaDoc" >
        <antcall target="clean.artifacts.dir" />
        <antcall target="copy.lib" />
        <antcall target="build.javadoc.impl" />
        <antcall target="clean.dist.dir" />
    </target>

    <!-- Assembled build implementations -->
    <target name="build.base.impl">
        <antcall target="build.module.core.jar" />
        <antcall target="build.module.plugin.jar" />
        <antcall target="build.module.ui.jar" />
        <antcall target="build.module.demo.jar" />
    </target>
    <target name="build.complete.impl">
        <antcall target="build.complete.jar" />
        <antcall target="build.complete.deps.jar" />
    </target>
    <target name="build.featured.impl">
        <antcall target="build.weblaf.demo.jar" />
        <antcall target="build.npe.jar" />
    </target>
    <target name="build.src.impl">
        <antcall target="build.sources.zip" />
        <antcall target="build.sources.jar" />
    </target>
    <target name="build.javadoc.impl">
        <antcall target="build.javadoc.jar" />
    </target>

    <!-- =========================== Run targets ============================ -->

    <target name="run.weblaf" description="Display WebLaF information dialog" depends="build.complete.deps.jar">
        <java jar="${library.complete.deps.jar}" fork="true" />
    </target>

    <target name="run.weblaf.demo" description="Run WebLaF demo application" depends="build.weblaf.demo.jar">
        <java jar="${demo.application.jar}" fork="true" />
    </target>

    <target name="run.npe" description="Run Nine-Patch Editor" depends="build.npe.jar">
        <java jar="${ninepatcheditor.jar}" fork="true" />
    </target>

</project>